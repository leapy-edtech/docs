---
title: "Playbook: Rollback e Hotfix"
description: "Procedimento para rollback de deploy e aplica√ß√£o de hotfixes"
---

## Quando Usar

Use este playbook quando:

- Deploy causou problema em produ√ß√£o
- Bug cr√≠tico precisa de corre√ß√£o urgente
- Necess√°rio reverter para vers√£o anterior

## Classifica√ß√£o

| Tipo | Descri√ß√£o | Tempo Alvo |
|------|-----------|------------|
| **Rollback** | Reverter para vers√£o anterior | < 15 min |
| **Hotfix** | Corre√ß√£o r√°pida sem rollback | < 1 hora |

## Procedimento de Rollback

### 1. Decis√£o de Rollback

**Crit√©rios para rollback imediato:**

- [ ] Funcionalidade cr√≠tica quebrada
- [ ] Erro afeta > 10% dos usu√°rios
- [ ] Dados sendo corrompidos
- [ ] Seguran√ßa comprometida

### 2. Comunica√ß√£o

```markdown
üö® **ROLLBACK EM ANDAMENTO**

**Motivo**: [DESCRI√á√ÉO DO PROBLEMA]
**Impacto**: [QUEM EST√Å SENDO AFETADO]
**ETA**: [TEMPO ESTIMADO]
**Respons√°vel**: [NOME]

Atualiza√ß√µes no #incidents
```

### 3. Executar Rollback

#### Vercel (Frontend + API)

```bash
# Via Vercel Dashboard
# Deployments > [PREVIOUS DEPLOY] > Promote to Production

# Ou via CLI
vercel rollback
```

#### Directus

```bash
# SSH no servidor ou via deploy
cd /app
git checkout [PREVIOUS_VERSION]
npm run build
pm2 restart directus
```

### 4. Verifica√ß√£o

- [ ] Aplica√ß√£o respondendo
- [ ] Funcionalidade cr√≠tica funcionando
- [ ] Logs sem erros
- [ ] M√©tricas normalizadas

### 5. P√≥s-Rollback

- [ ] Comunicar resolu√ß√£o
- [ ] Documentar incidente
- [ ] Agendar postmortem

## Procedimento de Hotfix

### 1. Avalia√ß√£o

**Perguntas:**

- O problema pode esperar o pr√≥ximo deploy normal?
- O fix √© simples e de baixo risco?
- H√° possibilidade de causar mais problemas?

### 2. Criar Branch de Hotfix

```bash
git checkout main
git pull origin main
git checkout -b hotfix/description
```

### 3. Implementar Fix

- C√≥digo m√≠nimo necess√°rio
- Testes para o caso espec√≠fico
- Code review obrigat√≥rio (mesmo que r√°pido)

### 4. Deploy do Hotfix

```bash
# Merge direto para main (com aprova√ß√£o)
git checkout main
git merge hotfix/description
git push origin main

# Deploy autom√°tico ou manual
```

### 5. Verifica√ß√£o

- [ ] Fix aplicado em produ√ß√£o
- [ ] Problema resolvido
- [ ] Sem efeitos colaterais

### 6. Documenta√ß√£o

```markdown
## Hotfix: [T√çTULO]

**Data**: YYYY-MM-DD HH:MM
**Commit**: [HASH]
**PR**: #[NUMBER]

**Problema**: [DESCRI√á√ÉO]
**Solu√ß√£o**: [DESCRI√á√ÉO]
**Impacto**: [USU√ÅRIOS AFETADOS]
**Tempo de resolu√ß√£o**: X minutos
```

## Checklist de Emerg√™ncia

### Pr√©-Rollback/Hotfix

- [ ] Incidente declarado
- [ ] Canal de comunica√ß√£o ativo
- [ ] Respons√°vel identificado
- [ ] Decis√£o tomada (rollback vs hotfix)

### Durante

- [ ] Atualiza√ß√µes a cada 15 minutos
- [ ] Logs sendo monitorados
- [ ] Backup dispon√≠vel (se aplic√°vel)

### P√≥s

- [ ] Verifica√ß√£o completa
- [ ] Comunica√ß√£o de resolu√ß√£o
- [ ] Incidente documentado
- [ ] Postmortem agendado

## Templates de Comunica√ß√£o

### In√≠cio do Incidente

```
üö® [S1/S2] Incidente em andamento

**Problema**: [DESCRI√á√ÉO]
**Impacto**: [QUEM/O QUE]
**Status**: Investigando
**Pr√≥xima atualiza√ß√£o**: 15 minutos
```

### Atualiza√ß√£o

```
üì¢ Atualiza√ß√£o do incidente

**Status**: Rollback em andamento / Hotfix sendo aplicado
**ETA**: [TEMPO]
**Pr√≥xima atualiza√ß√£o**: 15 minutos
```

### Resolu√ß√£o

```
‚úÖ Incidente resolvido

**Problema**: [DESCRI√á√ÉO]
**Solu√ß√£o**: [ROLLBACK/HOTFIX]
**Dura√ß√£o**: X minutos
**Postmortem**: [LINK]
```

## Contatos de Emerg√™ncia

| √Årea | Contato |
|------|---------|
| Engenharia (On-call) | [PAGERDUTY] |
| Infraestrutura | [CONTATO] |
| Produto | [CONTATO] |
| Comunica√ß√£o | [CONTATO] |
