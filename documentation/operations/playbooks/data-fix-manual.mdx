---
title: "Playbook: Corre√ß√£o Manual de Dados"
description: "Procedimento para corre√ß√µes manuais seguras em dados de produ√ß√£o"
---

## Quando Usar

Use este playbook quando:

- Dados incorretos precisam ser corrigidos
- Bug causou inconsist√™ncia em registros
- Solicita√ß√£o de cliente para ajuste de dados
- Migra√ß√£o manual necess√°ria

## Princ√≠pios

1. **Sempre fa√ßa backup** antes de qualquer altera√ß√£o
2. **Documente tudo** - antes, durante e depois
3. **Valide duas vezes** - antes de executar
4. **M√≠nimo necess√°rio** - altere apenas o que precisa

## N√≠veis de Risco

| N√≠vel | Descri√ß√£o | Aprova√ß√£o |
|-------|-----------|-----------|
| üü¢ Baixo | 1-10 registros, campos n√£o cr√≠ticos | Tech Lead |
| üü° M√©dio | 11-100 registros ou campos importantes | Tech Lead + PM |
| üî¥ Alto | > 100 registros ou dados cr√≠ticos | CTO + Documenta√ß√£o formal |

## Procedimento

### 1. Documenta√ß√£o Pr√©via

Criar documento de corre√ß√£o:

```markdown
# Corre√ß√£o de Dados - [T√çTULO]

**Data**: YYYY-MM-DD
**Solicitante**: [NOME]
**Respons√°vel**: [NOME]
**Ticket**: [LINK]

## Contexto
[DESCRI√á√ÉO DO PROBLEMA]

## Escopo
- **Tenant(s)**: [IDS]
- **Tabela(s)**: [NOMES]
- **Registros**: [QUANTIDADE ESTIMADA]
- **Campos**: [LISTA]

## Query de Identifica√ß√£o
```sql
[QUERY]
```

## Query de Corre√ß√£o
```sql
[QUERY]
```

## Valida√ß√£o
[COMO VALIDAR QUE FUNCIONOU]

## Rollback
[COMO DESFAZER SE NECESS√ÅRIO]
```

### 2. Backup

```sql
-- Criar backup da tabela
CREATE TABLE backup_[TABLE]_[DATE] AS
SELECT * FROM [TABLE]
WHERE [CONDITIONS];

-- Verificar backup
SELECT COUNT(*) FROM backup_[TABLE]_[DATE];
```

### 3. Identificar Registros

```sql
-- Identificar registros afetados
SELECT id, [FIELDS_TO_CHANGE], [CONTEXT_FIELDS]
FROM [TABLE]
WHERE [CONDITIONS];
```

**Validar:**
- [ ] Quantidade de registros est√° correta?
- [ ] Registros s√£o os esperados?
- [ ] N√£o h√° registros indevidos?

### 4. Dry Run

```sql
-- Simular a altera√ß√£o
BEGIN;

UPDATE [TABLE]
SET [FIELD] = [NEW_VALUE]
WHERE [CONDITIONS];

-- Verificar resultado
SELECT * FROM [TABLE] WHERE [CONDITIONS];

-- N√ÉO fazer COMMIT, apenas verificar
ROLLBACK;
```

### 5. Executar Corre√ß√£o

```sql
-- Executar com transa√ß√£o
BEGIN;

UPDATE [TABLE]
SET [FIELD] = [NEW_VALUE],
    updated_at = NOW()
WHERE [CONDITIONS];

-- Verificar n√∫mero de linhas afetadas
-- [X rows affected] deve bater com o esperado

-- Se correto:
COMMIT;

-- Se incorreto:
ROLLBACK;
```

### 6. Valida√ß√£o

```sql
-- Verificar corre√ß√£o
SELECT id, [FIELDS], updated_at
FROM [TABLE]
WHERE [CONDITIONS]
ORDER BY updated_at DESC;

-- Comparar com backup
SELECT 
  a.id,
  a.[FIELD] as new_value,
  b.[FIELD] as old_value
FROM [TABLE] a
JOIN backup_[TABLE]_[DATE] b ON a.id = b.id
WHERE [CONDITIONS];
```

### 7. A√ß√µes Relacionadas

Ap√≥s corre√ß√£o, pode ser necess√°rio:

```bash
# Invalidar cache
inngest.send({
  name: "cache/invalidate",
  data: { keys: ["affected_keys"] }
})

# Reprocessar m√©tricas
inngest.send({
  name: "insights/recalculate",
  data: { tenant_id: "...", metrics: ["..."] }
})

# Notificar sistemas integrados
inngest.send({
  name: "integration/sync",
  data: { entity: "...", ids: ["..."] }
})
```

### 8. Documenta√ß√£o Final

```markdown
## Resultado

**Status**: ‚úÖ Sucesso / ‚ùå Falha
**Registros alterados**: X
**Tempo de execu√ß√£o**: Y minutos
**Valida√ß√£o**: [DESCRI√á√ÉO]

## Evid√™ncias
- Screenshot antes: [LINK]
- Screenshot depois: [LINK]
- Logs: [LINK]
```

### 9. Limpeza

Ap√≥s 7 dias sem problemas:

```sql
-- Remover backup
DROP TABLE backup_[TABLE]_[DATE];
```

## Rollback

Se algo der errado:

```sql
-- Restaurar do backup
BEGIN;

UPDATE [TABLE] t
SET 
  [FIELD1] = b.[FIELD1],
  [FIELD2] = b.[FIELD2],
  updated_at = NOW()
FROM backup_[TABLE]_[DATE] b
WHERE t.id = b.id;

COMMIT;
```

## Checklist

### Pr√©-Execu√ß√£o
- [ ] Documento de corre√ß√£o criado
- [ ] Backup realizado
- [ ] Query de identifica√ß√£o validada
- [ ] Dry run executado
- [ ] Aprova√ß√£o obtida

### Execu√ß√£o
- [ ] Transa√ß√£o aberta
- [ ] Corre√ß√£o executada
- [ ] N√∫mero de linhas verificado
- [ ] Commit realizado

### P√≥s-Execu√ß√£o
- [ ] Valida√ß√£o feita
- [ ] Cache invalidado (se aplic√°vel)
- [ ] M√©tricas reprocessadas (se aplic√°vel)
- [ ] Documento atualizado
- [ ] Stakeholder notificado
