---
title: "Endpoints Customizados - Pulsos"
description: "APIs customizadas além dos endpoints CRUD padrão do Directus"
---

## Visão Geral

Além dos endpoints CRUD padrão do Directus (`/items/pulsos_*`), o sistema possui **20+ endpoints customizados** implementados como extensions que fornecem lógica de negócio avançada, analytics e operações especializadas.

**Base URL**: `https://backoffice.leapy.com`

<Tip>
  Estes endpoints são implementados como extensions do Directus localizadas em `directus-backoffice-with-extensions/src/extensions/`.
</Tip>

---

## Analytics e Histórico

Endpoints para consultar histórico e métricas de performance de talentos.

### GET /pulsos/performance/:jovem_id

Retorna histórico de avaliações de performance de um talento ao longo dos últimos 5 pulsos.

**Parâmetros**:
- `jovem_id` (path, required) - ID do talento

**Resposta**: Array com objetos contendo `pulso`, `performance`, `performance_score`, `data_resposta`

**Conversão de Performance para Score**:

| Performance | Score |
|-------------|-------|
| Abaixo | 1 |
| Dentro | 2 |
| Acima | 3 |

**Uso**: Gráficos de evolução de performance no dashboard

---

### GET /pulsos/efetivacao/:jovem_id

Retorna histórico de status de efetivação do talento nos últimos pulsos.

**Parâmetros**:
- `jovem_id` (path, required) - ID do talento

**Resposta**: Array com objetos contendo `pulso`, `status_efetivacao`, `data_resposta`

**Possíveis Status**:
- Sem Contrato
- Efetivado
- Em Processo
- Não Efetivado

---

## Gestão de Acesso

Endpoints para controlar permissões e configurações específicas de cada conta.

### GET /pulsos-access/me

Retorna configurações e permissões de pulsos do usuário autenticado.

**Headers**:
- `Authorization: Bearer <user_token>`

**Resposta**: Objeto contendo `account_id`, `company_name`, permissões (`can_create_pulsos`, `can_view_analytics`) e `pulsos_config`

**Uso**: Validar acesso do usuário antes de exibir funcionalidades

---

### GET /pulsos-access/questions/:account_id

Retorna perguntas configuradas para uma conta específica.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Resposta**: Objeto com arrays `pulsos_jovens`, `pulsos_liderancas` e `pulsos_rh`, cada um contendo perguntas com `id`, `question`, `type`, `required`, `order`

**Tipos de pergunta**: rating, text, boolean, choice

---

### PATCH /pulsos-access/settings/:account_id

Atualiza quais perfis de pulsos estão habilitados para uma conta.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Body**:
- `profile_enabled` - Objeto com flags `jovens`, `liderancas`, `rh`

**Resposta**: Configuração atualizada

---

## Agendamento

Endpoints para configurar e reagendar pulsos.

### GET /pulsos-schedule/settings/:account_id

Retorna configurações de agendamento de uma conta.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Resposta**: Objeto com `periodicidade_dias`, `data_proximo_pulso`, `auto_schedule_enabled`, `notification_days_before`

**Exemplo**: Periodicidade de 90 dias significa novo pulso a cada 3 meses

---

### GET /pulsos-schedule/settings/me

Retorna configurações de agendamento da empresa do usuário autenticado.

**Headers**:
- `Authorization: Bearer <user_token>`

**Resposta**: Array de configurações por perfil (jovens, liderancas, rh), incluindo `cadence_unit`, `cadence_interval`, `next_pulso_date`, `futureOpenPulsosCount`

---

### POST /pulsos-schedule/reschedule/:pulso_id

Reagenda um pulso específico para uma nova data.

**Parâmetros**:
- `pulso_id` (path, required) - ID do pulso

**Body**:
- `nova_data` (required) - Nova data de vencimento (formato: YYYY-MM-DD)
- `motivo` (optional) - Motivo do reagendamento

**Resposta**: Objeto com `id`, `data_antiga`, `data_nova`, `reagendado_em`

**Validações**:
- Nova data deve ser futura
- Pulso não pode estar finalizado

---

### PATCH /pulsos-schedule/sync-all/:account_id

Sincroniza a data do próximo pulso de todos os perfis de uma empresa para a mesma data.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Body**:
- `next_pulso_date` (required) - Nova data para todos os perfis (YYYY-MM-DD)
- `change_reason` (optional) - Motivo da sincronização

**Resposta**: Configurações atualizadas de todos os perfis

**Caso de uso**: Quando RH quer sincronizar todos os tipos de pulsos na mesma data para facilitar gestão

---

### GET /pulsos-schedule/history/:account_id

Retorna histórico de alterações de configuração de agendamento de uma conta.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Query Parameters**:
- `profile` (optional) - Filtrar por perfil específico (jovens, liderancas, rh)
- `limit` (optional, default: 50) - Limite de resultados
- `offset` (optional, default: 0) - Offset para paginação

**Resposta**: Array de objetos com histórico incluindo `cadence_interval`, `cadence_unit`, `next_pulso_date`, `change_reason`, `changed_by`, `changed_at`

**Uso**: Auditoria de mudanças nas configurações de agendamento

---

## Filtros com Controle de Acesso

Endpoints para buscar pulsos com controle de acesso integrado.

### GET /pulsos-filtered/jovens

Retorna pulsos de jovens que o usuário tem permissão para visualizar, aplicando automaticamente controle de acesso baseado no role e empresa do usuário.

**Query Parameters**:
- `status` (optional) - Filtrar por status (pendente, respondido, vencido, agendado)
- `account_id` (optional) - Filtrar por conta específica
- `turma_id` (optional) - Filtrar por turma
- `limit` (optional, default: 50, max: 100) - Limite de resultados
- `offset` (optional, default: 0) - Offset para paginação

**Headers**:
- `Authorization: Bearer <user_token>`

**Resposta**: Objeto com array `data` contendo pulsos expandidos (inclui dados do jovem) e `meta` com informações de paginação (`total`, `limit`, `offset`)

**Controle de Acesso**:
- RH: vê todos os pulsos da empresa
- Liderança: vê apenas pulsos dos talentos sob sua gestão
- Talento: vê apenas seus próprios pulsos

---

### GET /pulsos-filtered/liderancas

Retorna pulsos de lideranças que o usuário tem permissão para visualizar, com controle de acesso integrado.

**Query Parameters**: Mesmos parâmetros do endpoint de jovens

**Headers**:
- `Authorization: Bearer <user_token>`

**Resposta**: Similar ao endpoint de jovens, mas para avaliações de lideranças

**Uso**: Dashboards e listagens com segurança integrada

---

### GET /pulsos-filtered/rh

Retorna pulsos de RH filtrados por permissões.

**Query Parameters**: Similar aos endpoints anteriores

**Headers**:
- `Authorization: Bearer <user_token>`

**Controle de Acesso**: Apenas usuários com role RH ou Admin

---

## Operações em Lote

Endpoints para criar múltiplos pulsos de uma vez.

### POST /pulsos/rh

Cria pulsos de RH em lote para múltiplos usuários de uma empresa.

**Body**:
- `account_id` (required) - ID da conta/empresa
- `data_inicio` (required) - Data de início do pulso (YYYY-MM-DD)
- `data_fim` (required) - Data de fim do pulso (YYYY-MM-DD)
- `user_ids` (required) - Array de UUIDs de usuários RH

**Validações**:
- `data_inicio` deve ser >= hoje
- `data_fim` deve ser > `data_inicio`
- Mínimo 7 dias entre início e fim
- Usuários devem ter contratos ativos
- Não pode haver pulsos RH abertos para os mesmos usuários

**Resposta**:
- `criados` - Número de pulsos criados
- `pulsos` - Array com IDs e detalhes dos pulsos criados
- `erros` (se houver) - Array com erros de validação

**Processo**:
1. Valida datas e contratos
2. Cria pulsos em transação
3. Dispara eventos de notificação
4. Retorna IDs dos pulsos criados

---

### POST /pulsos/jovens/batch

Cria múltiplos pulsos para jovens de uma vez.

**Body**:
- `account_id` (required)
- `jovem_ids` (required) - Array de IDs de talentos
- `data_inicio` (required)
- `data_fim` (required)

**Uso**: Criação manual de pulsos fora do agendamento automático

---

### POST /processa-pulsos/inngest

Endpoint interno que processa criação de pulsos via Inngest.

**Body**:
- `profile` - Tipo de pulso (jovens, liderancas, rh)
- `account_id` - ID da empresa
- `config` - Configurações de periodicidade

**Uso**: Chamado por jobs Inngest para agendamento automático

<Warning>
  Este endpoint é interno e só deve ser chamado pelo sistema Inngest.
</Warning>

---

## Estatísticas e Dashboards

Endpoints para dashboards e visualizações de dados agregados.

### GET /pulsos/stats/:account_id

Retorna estatísticas gerais de pulsos de uma empresa.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Query Parameters**:
- `profile` (optional) - Filtrar por perfil (jovens, liderancas, rh)
- `start_date` (optional) - Data inicial (YYYY-MM-DD)
- `end_date` (optional) - Data final (YYYY-MM-DD)

**Resposta**:
- `total` - Total de pulsos
- `por_status` - Breakdown por status (pendente, respondido, vencido, etc)
- `taxa_resposta` - % de pulsos respondidos
- `tempo_medio_resposta` - Tempo médio em dias para responder
- `pulsos_vencidos` - Quantidade de pulsos não respondidos no prazo

**Uso**: Dashboard principal do RH

---

### GET /pulsos/completion-rate/:account_id

Retorna taxa de completude de pulsos por período.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Query Parameters**:
- `period` (optional, default: "month") - Granularidade (week, month, quarter)
- `profile` (optional) - Filtrar por perfil

**Resposta**: Array com taxa de completude por período

**Uso**: Gráficos de tendência de engajamento

---

### GET /pulsos/performance-distribution/:account_id

Retorna distribuição de avaliações de performance.

**Parâmetros**:
- `account_id` (path, required) - ID da conta

**Query Parameters**:
- `pulso_numero` (optional) - Filtrar por número específico de pulso
- `turma_id` (optional) - Filtrar por turma

**Resposta**: Objeto com contagem por categoria (Abaixo, Dentro, Acima)

**Uso**: Visualizar distribuição de performance da turma

---

## Workflows (Operações Internas)

<Warning>
  Estes endpoints são **apenas para uso interno** do Directus. São chamados por **Hooks CRON** e disparam eventos Inngest.
</Warning>

Endpoints especializados localizados em `extensions/endpoints-workflows/src/pulsos/` que fazem parte do mecanismo de automação do sistema.

### Arquitetura Hook → Endpoint → Evento

Estes endpoints são parte da arquitetura de automação:

1. **Hook CRON** dispara em horário configurado
2. **Endpoint Workflow** consulta dados e valida regras
3. **Evento Inngest** é disparado para processar jobs assíncronos

**URL Base**:
- Local: `http://localhost:8055/pulsos/`
- Produção: `https://backoffice.leapy.com/pulsos/`

---

### GET /pulsos/send-liberacao-pulsos-rh-to-rh

Envia notificações de liberação de pulsos RH.

**Chamado por**: Hook CRON `hook-cron-send-liberacao-pulsos-rh-to-rh` (diariamente às 8:00)

**Query Parameters**:
- `status` (default: "agendado") - Status dos pulsos a buscar
- `send_event` (default: true) - Se deve disparar evento Inngest

**Evento disparado**: `backoffice/pulsos_rh/liberacao-to-rh.send`

---

### GET /pulsos/send-liberacao-pulsos-rh-to-jovens

Envia notificações de liberação para jovens.

**Chamado por**: Hook CRON (diariamente às 8:05)

**Query Parameters**: Similar ao endpoint RH

**Evento disparado**: `backoffice/pulsos_rh/liberacao-to-jovens.send`

---

### GET /pulsos/send-lembrete-pulsos-rh-to-rh

Envia lembretes para RH sobre pulsos pendentes.

**Chamado por**: Hook CRON (diariamente às 8:00)

**Evento disparado**: `backoffice/pulsos_rh/lembrete-to-rh.send`

---

### GET /pulsos/send-lembrete

Envia lembretes gerais de pulsos pendentes.

**Chamado por**: Hook CRON (diariamente às 5:00)

**Evento disparado**: `backoffice/send-lembrete-pulsos.send`

---

### Fluxo Completo

| Hook CRON | Horário | Endpoint | Evento Inngest | Job Final |
|-----------|---------|----------|----------------|-----------|
| `hook-cron-send-liberacao-pulsos-rh-to-rh` | 8:00 | `/pulsos/send-liberacao-pulsos-rh-to-rh` | `liberacao-to-rh.send` | Email/WhatsApp RH |
| `hook-cron-send-liberacao-pulsos-rh-to-jovens` | 8:05 | `/pulsos/send-liberacao-pulsos-rh-to-jovens` | `liberacao-to-jovens.send` | Email/WhatsApp Jovens |
| `hook-cron-send-lembrete-pulsos-rh-to-rh` | 8:00 | `/pulsos/send-lembrete-pulsos-rh-to-rh` | `lembrete-to-rh.send` | Lembretes RH |
| `hook-cron-send-lembrete` | 5:00 | `/pulsos/send-lembrete` | `send-lembrete-pulsos.send` | Lembretes Gerais |

<Tip>
  Para mais detalhes sobre a arquitetura de automação, consulte [Integrações - Workflows](/documentation/domains/pulses/integrations#endpoints-workflows-uso-interno).
</Tip>

---

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Endpoints CRUD Padrão" icon="database" href="/api-reference/backoffice/pulsos-jovens">
    APIs básicas do Directus
  </Card>
  <Card title="Webhooks e Eventos" icon="webhook" href="/documentation/domains/pulses/webhooks">
    Sistema de eventos Inngest
  </Card>
</CardGroup>
